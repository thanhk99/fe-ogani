<div class="order-detail-container">
  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <p>ƒêang t·∫£i chi ti·∫øt ƒë∆°n h√†ng...</p>
  </div>

  <!-- Order Detail -->
  <div *ngIf="!isLoading && order" class="order-detail">
    <!-- Header -->
    <div class="detail-header">
      <button (click)="onGoBack()" class="btn btn-back">
        ‚Üê Quay l·∫°i
      </button>
      <h2>Chi ti·∫øt ƒë∆°n h√†ng #{{order.id}}</h2>
      <div class="header-actions">
        <button (click)="onPrintOrder()" class="btn btn-print">
          üñ®Ô∏è In ƒë∆°n h√†ng
        </button>
        
        <!-- Admin Actions -->
        <div *ngIf="isAdmin" class="admin-actions">
          <!-- N√∫t x√°c nh·∫≠n - ch·ªâ hi·ªÉn th·ªã khi orderStatus l√† CONFIRMED -->
          <button *ngIf="order.orderStatus === 'CONFIRMED'" 
                  (click)="onStatusButtonClick('confirm')"
                  [disabled]="isButtonDisabled(order.orderStatus)"
                  class="btn btn-confirm">
            X√°c nh·∫≠n ƒë∆°n h√†ng
          </button>

          <!-- N√∫t b·∫Øt ƒë·∫ßu giao - ch·ªâ hi·ªÉn th·ªã khi orderStatus l√† PAID -->
          <button *ngIf="order.orderStatus === 'PAID'" 
                  (click)="onStatusButtonClick('ship')"
                  [disabled]="isButtonDisabled(order.orderStatus)"
                  class="btn btn-ship">
            B·∫Øt ƒë·∫ßu giao h√†ng
          </button>

          <!-- N√∫t ho√†n th√†nh - ch·ªâ hi·ªÉn th·ªã khi orderStatus l√† SHIPPING -->
          <button *ngIf="order.orderStatus === 'SHIPPING'" 
                  (click)="onStatusButtonClick('complete')"
                  [disabled]="isButtonDisabled(order.orderStatus)"
                  class="btn btn-complete">
            Ho√†n th√†nh ƒë∆°n h√†ng
          </button>

          <!-- Hi·ªÉn th·ªã th√¥ng b√°o cho c√°c tr·∫°ng th√°i kh√¥ng th·ªÉ thao t√°c -->
          <span *ngIf="isButtonDisabled(order.orderStatus) && order.orderStatus" class="no-action-text">
            Kh√¥ng th·ªÉ thao t√°c
          </span>
        </div>
      </div>
    </div>

    <!-- Order Status -->
    <div class="status-section">
      <div class="status-info">
        <strong>Tr·∫°ng th√°i:</strong>
        <span class="status-badge" [class]="getStatusClass(order.orderStatus)">
          {{getStatusText(order.orderStatus)}}
        </span>
      </div>
    </div>

    <!-- Two Columns Layout -->
    <div class="detail-content">
      <!-- Left Column - Customer & Order Info -->
      <div class="left-column">
        <!-- Customer Information -->
        <div class="info-card">
          <h3>Th√¥ng tin {{isAdmin ? 'kh√°ch h√†ng' : 'c·ªßa t√¥i'}}</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>H·ªç t√™n:</strong>
              <span>{{getCustomerFullName()}}</span>
            </div>
            <div class="info-item">
              <strong>Email:</strong>
              <span>{{order.email || 'N/A'}}</span>
            </div>
            <div class="info-item">
              <strong>S·ªë ƒëi·ªán tho·∫°i:</strong>
              <span>{{order.phone || 'N/A'}}</span>
            </div>
            <div class="info-item">
              <strong>ƒê·ªãa ch·ªâ:</strong>
              <span>{{order.address || 'N/A'}}</span>
            </div>
            <div class="info-item" *ngIf="order.town">
              <strong>Th·ªã tr·∫•n/Th√†nh ph·ªë:</strong>
              <span>{{order.town}}</span>
            </div>
            <div class="info-item" *ngIf="order.country">
              <strong>Qu·ªëc gia:</strong>
              <span>{{order.country}}</span>
            </div>
          </div>
        </div>

        <!-- Order Information -->
        <div class="info-card">
          <h3>Th√¥ng tin ƒë∆°n h√†ng</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>M√£ ƒë∆°n h√†ng:</strong>
              <span>#{{order.id}}</span>
            </div>
            <div class="info-item">
              <strong>T·ªïng s·∫£n ph·∫©m:</strong>
              <span>{{calculateTotalQuantity()}} s·∫£n ph·∫©m</span>
            </div>
            <div class="info-item">
              <strong>Ng√†y ƒë·∫∑t h√†ng:</strong>
              <span>{{formatDate(order.orderDate) || 'N/A'}}</span>
            </div>
            <div class="info-item">
              <strong>Ng√†y thanh to√°n:</strong>
              <span [class]="order.orderStatus === 'PAID' ? 'payment-date paid' : 'payment-date not-paid'">
                {{formatDate(getPaymentDate())}}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Order Items & Notes -->
      <div class="right-column">
        <!-- Order Items -->
        <div class="info-card">
          <h3>Chi ti·∫øt s·∫£n ph·∫©m ({{orderItems.length}} s·∫£n ph·∫©m)</h3>
          <div *ngIf="orderItems.length > 0" class="order-items">
            <div *ngFor="let item of orderItems" class="order-item">
              <div class="item-info">
                <div class="item-main">
                  <h4>{{item.name || 'S·∫£n ph·∫©m #' + item.productId}}</h4>
                  <div class="item-details">
                    <p class="item-price">Gi√°: {{item.price | currency:'VND':'symbol':'1.0-0'}}</p>
                    <p class="item-quantity">S·ªë l∆∞·ª£ng: {{item.quantity}}</p>
                    <p class="item-id">M√£ SP: {{item.productId}}</p>
                  </div>
                </div>
                <div class="item-total">
                  {{item.subTotal | currency:'VND':'symbol':'1.0-0'}}
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="orderItems.length === 0" class="no-items">
            <p>Kh√¥ng c√≥ s·∫£n ph·∫©m trong ƒë∆°n h√†ng</p>
          </div>
        </div>

        <!-- Notes -->
        <div class="info-card">
          <h3>Ghi ch√∫ ƒë∆°n h√†ng</h3>
          <div class="notes-content">
            <p>{{order.note || 'Kh√¥ng c√≥ ghi ch√∫'}}</p>
          </div>
        </div>

        <!-- User Information (Ch·ªâ hi·ªÉn th·ªã cho admin) -->
        <div class="info-card" *ngIf="isAdmin && order.user">
          <h3>Th√¥ng tin t√†i kho·∫£n</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>Username:</strong>
              <span>{{order.user.username}}</span>
            </div>
            <div class="info-item">
              <strong>Email:</strong>
              <span>{{order.user.email}}</span>
            </div>
            <div class="info-item">
              <strong>Vai tr√≤:</strong>
              <span>{{order.user.role === 'ROLE_ADMIN' ? 'Qu·∫£n tr·ªã vi√™n' : 'Ng∆∞·ªùi d√πng'}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
      <div class="summary-row">
        <span>T·ªïng ti·ªÅn h√†ng:</span>
        <span>{{calculateItemsTotal() | currency:'VND':'symbol':'1.0-0'}}</span>
      </div>
      <div class="summary-row">
        <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
        <span>0 ‚Ç´</span>
      </div>
      <div class="summary-row total">
        <strong>T·ªïng thanh to√°n:</strong>
        <strong>{{order.totalPrice | currency:'VND':'symbol':'1.0-0'}}</strong>
      </div>
    </div>
  </div>

  <!-- Not Found -->
  <div *ngIf="!isLoading && !order" class="not-found">
    <h3>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng</h3>
    <button (click)="onGoBack()" class="btn btn-primary">Quay l·∫°i</button>
  </div>
</div>