<div class="order-container">
  <h2>Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
  
  <!-- B·ªô l·ªçc v√† t√¨m ki·∫øm -->
  <div class="filter-section">
    <div class="filter-group">
      <label for="statusFilter">L·ªçc theo tr·∫°ng th√°i:</label>
      <select id="statusFilter" 
              [(ngModel)]="selectedStatus" 
              (change)="onStatusFilterChange()"
              class="status-filter">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="PENDING">ƒêang ch·ªù thanh to√°n VNPay</option>
        <option value="CONFIRMED">Ch·ªù x√°c nh·∫≠n</option>
        <option value="PAID">ƒê√£ thanh to√°n</option>
        <option value="SHIPPING">ƒêang giao</option>
        <option value="COMPLETED">Giao th√†nh c√¥ng</option>
        <option value="CANCELLED">ƒê√£ hu·ª∑</option>
      </select>
    </div>

    <div class="search-group">
      <input type="text" 
             [(ngModel)]="searchTerm" 
             (input)="onSearch()"
             placeholder="T√¨m ki·∫øm theo m√£ ƒë∆°n h√†ng, t√™n kh√°ch h√†ng..."
             class="search-input">
    </div>
  </div>

  <!-- Th·ªëng k√™ -->
  <div class="order-stats" *ngIf="filteredOrders.length > 0">
    <div class="stat-item">
      <span class="stat-label">T·ªïng s·ªë ƒë∆°n:</span>
      <span class="stat-value">{{ filteredOrders.length }}</span>
    </div>
    <div class="stat-item" *ngFor="let stat of statusStats | keyvalue">
      <span class="stat-label">{{ statusMap[stat.key] }}:</span>
      <span class="stat-value">{{ stat.value }}</span>
    </div>
  </div>
  
  <div *ngIf="filteredOrders.length === 0" class="no-orders">
    <p>{{ searchTerm || selectedStatus ? 'Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ph√π h·ª£p' : 'Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o' }}</p>
  </div>
  
  <!-- Danh s√°ch ƒë∆°n h√†ng -->
  <div class="order-list">
    <div *ngFor="let order of paginatedOrders" class="order-item">
      <!-- N·ªôi dung ƒë∆°n h√†ng gi·ªØ nguy√™n -->
      <div class="order-header">
        <h3>ƒê∆°n h√†ng #{{order?.id || 'N/A'}}</h3>
        <span class="status-badge" [class]="getStatusClass(order?.orderStatus)">
          {{getStatusText(order?.orderStatus)}}
        </span>
      </div>
      
      <div class="order-details">
        <p><strong>Kh√°ch h√†ng:</strong> {{getCustomerFullName(order)}}</p>
        <p><strong>Email:</strong> {{order?.email || 'N/A'}}</p>
        <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> {{order?.phone || 'N/A'}}</p>
        <p><strong>ƒê·ªãa ch·ªâ:</strong> {{order?.address || 'N/A'}}</p>
        <p><strong>T·ªïng ti·ªÅn:</strong> {{order?.totalPrice | currency:'VND':'symbol':'1.0-0'}}</p>
        
        <p><strong>Ng√†y thanh to√°n:</strong> 
          <span [class]="order?.orderStatus === 'PAID' ? 'payment-date paid' : 'payment-date not-paid'">
            {{formatDate(getPaymentDate(order))}}
          </span>
        </p>
        
        <p><strong>Ghi ch√∫:</strong> {{order?.note || 'Kh√¥ng c√≥ ghi ch√∫'}}</p>
      </div>

      <div class="order-actions">
        <!-- C√°c n√∫t action gi·ªØ nguy√™n -->
        <button *ngIf="order?.orderStatus === 'PENDING'" 
                (click)="onStatusButtonClick(order, 'cancel')"
                class="btn btn-cancel">
          ‚ùå Hu·ª∑ ƒë∆°n h√†ng
        </button>

        <button *ngIf="order?.orderStatus === 'CONFIRMED'" 
                (click)="onStatusButtonClick(order, 'confirm')"
                [disabled]="isButtonDisabled(order?.orderStatus)"
                class="btn btn-confirm">
          X√°c nh·∫≠n ƒë∆°n h√†ng
        </button>

        <button *ngIf="order?.orderStatus === 'PAID'" 
                (click)="onStatusButtonClick(order, 'ship')"
                [disabled]="isButtonDisabled(order?.orderStatus)"
                class="btn btn-ship">
          B·∫Øt ƒë·∫ßu giao h√†ng
        </button>

        <button *ngIf="order?.orderStatus === 'SHIPPING'" 
                (click)="onStatusButtonClick(order, 'complete')"
                [disabled]="isButtonDisabled(order?.orderStatus)"
                class="btn btn-complete">
          Ho√†n th√†nh ƒë∆°n h√†ng
        </button>

        <span *ngIf="isButtonDisabled(order?.orderStatus) && order?.orderStatus && order?.orderStatus !== 'PENDING'" 
              class="no-action-text">
          Kh√¥ng th·ªÉ thao t√°c
        </span>

        <button (click)="viewOrderDetail(order.id)" 
                class="btn btn-detail">
          üëÅÔ∏è Xem chi ti·∫øt
        </button>
      </div>
    </div>
  </div>

  <!-- Ph√¢n trang -->
  <div class="pagination-container" *ngIf="filteredOrders.length > 0">
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{ startIndex + 1 }} - {{ endIndex }} c·ªßa {{ filteredOrders.length }} ƒë∆°n h√†ng
    </div>
    
    <div class="pagination-controls">
      <button (click)="previousPage()" 
              [disabled]="currentPage === 1"
              class="pagination-btn">
        ‚Äπ Tr∆∞·ªõc
      </button>
      
      <div class="page-numbers">
        <button *ngFor="let page of getPageNumbers()" 
                (click)="goToPage(page)"
                [class.active]="page === currentPage"
                class="page-btn">
          {{ page }}
        </button>
      </div>
      
      <button (click)="nextPage()" 
              [disabled]="currentPage === totalPages"
              class="pagination-btn">
        Sau ‚Ä∫
      </button>
    </div>

    <div class="page-size-selector">
      <label>Hi·ªÉn th·ªã:</label>
      <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>

  <!-- Toast messages -->
  <p-toast></p-toast>
</div>